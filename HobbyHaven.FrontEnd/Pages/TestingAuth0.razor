@page "/fetchdata"
@using System.Net.Http
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Microsoft.AspNetCore.Components.Authorization
@inject HttpClient HttpClient
@inject IAccessTokenProvider AccessTokenProvider
@inject AuthenticationStateProvider AuthenticationStateProvider

<h1>Weather forecast</h1>

@rsp

@code {
    string? rsp;

    protected override async Task OnInitializedAsync()
    {
        var tokenResult = await AccessTokenProvider.RequestAccessToken();
        if (tokenResult.TryGetToken(out var token))
        {
            HttpClient.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token.Value);
            var forecasts = await HttpClient.GetAsync("https://localhost:44357/api/0auth/profile");
            rsp = forecasts.StatusCode.ToString();

            Console.WriteLine(forecasts.Content.ToString());
        }
    }
}